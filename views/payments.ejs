<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payments)</title>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #e6f7ff; }
        .form-container { background-color: #f0f8ff; padding: 15px; border: 1px solid #b3e0ff; margin-bottom: 20px; }
        .form-group { margin-bottom: 10px; }
        input, select { padding: 6px; width: 220px; margin-right: 10px; }
        button { padding: 6px 12px; cursor: pointer; background-color: #2196F3; color: white; border: none; }
        button:hover { background-color: #0b7dda; }
        .nav-menu { margin-bottom: 20px; padding: 10px; background-color: #333; color: white; }
        .nav-menu a { color: white; text-decoration: none; margin-right: 15px; font-weight: bold; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô */
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; color: white; display: inline-block; }
        .payment-paid { background-color: #4CAF50; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .payment-pending { background-color: #ff9800; } /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
    </style>
</head>
<body>

    <div style="margin-bottom: 20px; padding: 10px; background-color: #333;">
        <a href="/" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a>
        <a href="/devices" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üíª ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
        <a href="/technicians" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</a>
        <a href="/repairs" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</a>
        <a href="/payments" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
        <a href="/report-revenue" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</a>
    </div>

    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

    <div class="form-container">
        <h3>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <form action="/add-payment" method="POST">
            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°:</label>
                <select name="repair_id" required style="width: 400px;">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° --</option>
                    <% repairs.forEach(r => { %>
                        <option value="<%= r.repair_id %>">
                            ‡∏ö‡∏¥‡∏• #<%= r.repair_id %> - <%= r.problem_type %> (‡∏Ç‡∏≠‡∏á: <%= r.first_name %>, <%= r.brand %>)
                        </option>
                    <% }); %>
                </select>
            </div>
            <div class="form-group">
                <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó):</label>
                <input type="number" step="0.01" name="total_cost" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 1500">
                
                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞:</label>
                <input type="date" name="payment_date" required>
                
                <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                <select name="payment_status" required style="width: 150px;">
                    <option value="Paid">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (Paid)</option>
                    <option value="Pending">‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (Pending)</option>
                </select>
            </div>
            <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
        </form>
    </div>

    <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <table>
        <thead>
            <tr>
                <th>ID ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</th>
                <th>‡∏ö‡∏¥‡∏•‡∏ã‡πà‡∏≠‡∏° (Repair ID)</th>
                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody>
            <% if (payments.length === 0) { %>
                <tr><td colspan="7" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</td></tr>
            <% } else { %>
                <% payments.forEach(p => { %>
                    <tr>
                        <td><%= p.payment_id %></td>
                        <td>‡∏ö‡∏¥‡∏• #<%= p.repair_id %> (<%= p.problem_type %>)</td>
                        <td><%= p.first_name %> (<%= p.brand %>)</td>
                        <td style="font-weight: bold;"><%= p.total_cost %></td>
                        <td><%= p.payment_date %></td>
                        <td>
                            <% let pClass = p.payment_status === 'Paid' ? 'payment-paid' : 'payment-pending'; %>
                            <span class="status-badge <%= pClass %>"><%= p.payment_status %></span>
                        </td>
                        <td>
                            <a href="/edit-payment/<%= p.payment_id %>" style="background-color: #FFC107; color: black; text-decoration: none; padding: 4px 8px; border-radius: 3px; font-size: 13px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                            <form action="/delete-payment/<%= p.payment_id %>" method="POST" onsubmit="return confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ?');" style="display:inline;">
                                <button type="submit" style="padding: 4px 8px; font-size: 13px; border-radius: 3px; background-color: #f44336; color: white; border: none; cursor: pointer;">‡∏•‡∏ö</button>
                            </form>
                        </td>
                    </tr>
                <% }); %>
            <% } %>
        </tbody>
    </table>

</body>
</html>