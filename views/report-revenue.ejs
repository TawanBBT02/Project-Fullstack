<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</title>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; max-width: 900px; margin: auto; background-color: #f4f7f6; }
        .nav-menu { margin-bottom: 20px; padding: 10px; background-color: #333; color: white; border-radius: 5px; }
        .nav-menu a { color: white; text-decoration: none; margin-right: 15px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #e8f5e9; }
        .filter-box { background-color: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 20px; }
        input, select, button { padding: 6px; margin-right: 10px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 3px; }
        .money { color: #2e7d32; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

    <div class="nav-menu">
        <a href="/">üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a> <a href="/devices">üíª ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a> <a href="/technicians">üîß ‡∏ä‡πà‡∏≤‡∏á</a> 
        <a href="/repairs">üõ†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a> <a href="/payments">üí∞ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
        <span style="color: #aaa;">|</span>
        <a href="/report-repairs">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</a>
        <a href="/report-revenue" style="color: #ffeb3b;">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</a>
    </div>

    <h2>üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)</h2>

    <div class="filter-box">
        <form action="/report-revenue" method="GET">
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:</label>
            <select name="device_type">
                <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                <% types.forEach(t => { %>
                    <option value="<%= t.device_type %>" <%= type_filter == t.device_type ? 'selected' : '' %>><%= t.device_type %></option>
                <% }); %>
            </select>
            
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢:</label>
            <select name="payment_status">
                <option value="">-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                <option value="Paid" <%= status_filter == 'Paid' ? 'selected' : '' %>>‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (Paid)</option>
                <option value="Pending" <%= status_filter == 'Pending' ? 'selected' : '' %>>‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (Pending)</option>
            </select>
            
            <button type="submit">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <a href="/report-revenue" style="font-size: 14px; text-decoration: none; color: #f44336;">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</a>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 50px; text-align: center;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th style="text-align: center;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô (‡∏ö‡∏¥‡∏•)</th>
                <th style="text-align: right;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
            </tr>
        </thead>
        <tbody>
            <% 
                let totalSum = 0;
                if (report.length === 0) { 
            %>
                <tr><td colspan="5" style="text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</td></tr>
            <% } else { %>
                <% report.forEach((row, index) => { 
                    totalSum += row.total_revenue || 0;
                %>
                    <tr>
                        <td style="text-align: center; font-weight: bold;"><%= index + 1 %></td>
                        <td><%= row.device_type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' %></td>
                        <td><%= row.payment_status %></td>
                        <td style="text-align: center;"><%= row.total_jobs %></td>
                        <td style="text-align: right;" class="money"><%= (row.total_revenue || 0).toLocaleString() %></td>
                    </tr>
                <% }); %>
                <tr style="background-color: #f1f8e9;">
                    <td colspan="4" style="text-align: right; font-weight: bold;">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á):</td>
                    <td style="text-align: right; font-size: 18px; color: #1b5e20; font-weight: bold;">
                        <%= totalSum.toLocaleString() %> ‡∏ø
                    </td>
                </tr>
            <% } %>
        </tbody>
        <hr style="margin: 40px 0; border: 0; border-top: 1px solid #ccc;">

    <div style="display: flex; gap: 20px;">
        <div style="flex: 1;">
            <h3>üìÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
            <table>
                <thead>
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•</th>
                        <th style="text-align: right;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                    </tr>
                </thead>
                <tbody>
                    <% dailyReport.forEach(d => { %>
                        <tr>
                            <td><%= d.payment_date %></td>
                            <td><%= d.job_count %></td>
                            <td style="text-align: right;" class="money"><%= d.daily_total.toLocaleString() %> ‡∏ø</td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <div style="flex: 1;">
            <h3>üóìÔ∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
            <table>
                <thead>
                    <tr>
                        <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏¥‡∏•</th>
                        <th style="text-align: right;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                    </tr>
                </thead>
                <tbody>
                    <% monthlyReport.forEach(m => { %>
                        <tr>
                            <td><%= m.month %></td>
                            <td><%= m.job_count %></td>
                            <td style="text-align: right;" class="money"><%= m.monthly_total.toLocaleString() %> ‡∏ø</td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    </table>
    

</body>
</html>