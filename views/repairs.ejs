<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° (Repairs)</title>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #ffe6e6; }
        .form-group { margin-bottom: 10px; }
        input, select { padding: 5px; width: 220px; margin-right: 10px; }
        button { padding: 6px 12px; cursor: pointer; background-color: #f44336; color: white; border: none; }
        button:hover { background-color: #d32f2f; }
        .form-container { background-color: #fff2f2; padding: 15px; border: 1px solid #ffcccc; margin-bottom: 20px; }
        .nav-menu { margin-bottom: 20px; padding: 10px; background-color: #333; color: white; }
        .nav-menu a { color: white; text-decoration: none; margin-right: 15px; font-weight: bold; }
        .status-badge { padding: 3px 8px; border-radius: 10px; font-size: 12px; font-weight: bold; color: white; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: bold; color: white; display: inline-block; }
        
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Internal Style ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö */
        .status-completed { background-color: #4CAF50; } /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .status-inprogress { background-color: #2196F3; } /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
        .status-canceled { background-color: #9e9e9e; }  /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
        .status-pending { background-color: #ff9800; }   /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
    </style>
</head>
<body>

    <div style="margin-bottom: 20px; padding: 10px; background-color: #333;">
        <a href="/" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a>
        <a href="/devices" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üíª ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
        <a href="/technicians" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</a>
        <a href="/repairs" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</a>
        <a href="/payments" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üí∞ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
        <a href="/report-revenue" style="color: white; text-decoration: none; margin-right: 15px; font-weight: bold;">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</a>
    </div>

    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h2>

    <div class="form-container">
        <h3>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
        <form action="/add-repair" method="POST">
            <div class="form-group">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏°‡∏≤‡∏ã‡πà‡∏≠‡∏°:</label>
                <select name="device_id" required style="width: 350px;">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤) --</option>
                    <% devices.forEach(d => { %>
                        <option value="<%= d.device_id %>">
                            <%= d.brand %> <%= d.model %> (‡∏Ç‡∏≠‡∏á: <%= d.first_name %> <%= d.last_name %>)
                        </option>
                    <% }); %>
                </select>
                
                <label style="margin-left: 10px;">‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</label>
                <select name="technician_id" required>
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≤‡∏á --</option>
                    <% technicians.forEach(t => { %><option value="<%= t.technician_id %>">‡∏ä‡πà‡∏≤‡∏á <%= t.first_name %></option><% }); %>
                </select>
            </div>
            
            <div class="form-group">
                <input type="text" name="problem_type" placeholder="‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î)" required style="width: 250px;">
                <input type="date" name="receive_date" required title="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á" style="width: 150px;">
                <select name="status" required style="width: 150px;">
                    <option value="Pending">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                    <option value="In Progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</option>
                    <option value="Completed">‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à</option>
                    <option value="Canceled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                </select>
            </div>
            <div class="form-group">
                <input type="text" name="issue_description" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..." style="width: 100%; box-sizing: border-box;">
            </div>
            <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</button>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</th>
                <th>‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody>
            <% if (repairs.length === 0) { %>
                <tr><td colspan="8" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</td></tr>
            <% } else { %>
                <% repairs.forEach(r => { %>
                    <tr>
                        <td><%= r.repair_id %></td>
                        <td><%= r.receive_date %></td>
                        <td><%= r.c_fname %> <%= r.c_lname %></td>
                        <td><%= r.brand %> <%= r.model %></td>
                        <td><%= r.problem_type %></td>
                        <td><%= r.t_fname %></td>
                        <td>
                            <% 
                                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠ Class ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏µ
                                let statusClass = 'status-pending'; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                                if (r.status === 'Completed') statusClass = 'status-completed';
                                else if (r.status === 'In Progress') statusClass = 'status-inprogress';
                                else if (r.status === 'Canceled') statusClass = 'status-canceled';
                            %>
                            <span class="status-badge <%= statusClass %>"><%= r.status %></span>
                        </td>
                        <td>
                            <a href="/repair-details/<%= r.repair_id %>" style="background-color: #2196F3; color: white; text-decoration: none; padding: 4px 8px; border-radius: 3px; font-size: 13px; margin-right: 3px;">üîç ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                            
                            <a href="/edit-repair/<%= r.repair_id %>" style="background-color: #FFC107; color: black; text-decoration: none; padding: 4px 8px; border-radius: 3px; font-size: 13px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                            <form action="/delete-repair/<%= r.repair_id %>" method="POST" onsubmit="return confirm('‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ô‡∏µ‡πâ?');" style="display:inline;">
                                <button type="submit" style="padding: 4px 8px; font-size: 13px; border-radius: 3px; background-color: #f44336; color: white; border: none; cursor: pointer;">‡∏•‡∏ö</button>
                            </form>
                        </td>
                    </tr>
                <% }); %>
            <% } %>
        </tbody>
    </table>

</body>
</html>