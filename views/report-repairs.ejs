<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</title>
    <style>
        body { font-family: Tahoma, sans-serif; padding: 20px; max-width: 1000px; margin: auto; background-color: #f4f7f6; }
        .nav-menu { margin-bottom: 20px; padding: 10px; background-color: #333; color: white; border-radius: 5px; }
        .nav-menu a { color: white; text-decoration: none; margin-right: 15px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #e2e8f0; }
        .filter-box { background-color: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 20px; }
        input, select, button { padding: 6px; margin-right: 10px; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 3px; }
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå Dashboard Card */
        .card-container { display: flex; gap: 15px; margin-bottom: 20px; }
        .card { background: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd; flex: 1; text-align: center; border-top: 4px solid #2196F3; }
        .card h3 { margin: 0; color: #555; font-size: 16px; }
        .card p { font-size: 28px; font-weight: bold; color: #2196F3; margin: 10px 0 0 0; }
        .status-pending { color: #ff9800; font-weight: bold; }
        .status-inprogress { color: #2196F3; font-weight: bold; }
        .status-completed { color: #4CAF50; font-weight: bold; }
        .status-canceled { color: #9e9e9e; font-weight: bold; }
    </style>
</head>
<body>

    <div class="nav-menu">
        <a href="/">üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</a> <a href="/devices">üíª ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a> <a href="/technicians">üîß ‡∏ä‡πà‡∏≤‡∏á</a> 
        <a href="/repairs">üõ†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a> <a href="/payments">üí∞ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
        <span style="color: #aaa;">|</span>
        <a href="/report-repairs" style="color: #ffeb3b;">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</a>
        <a href="/report-revenue">üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</a>
    </div>

    <h2>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á</h2>

    <div class="card-container">
        <% summary.forEach(s => { %>
            <div class="card">
                <h3>‡∏ä‡πà‡∏≤‡∏á <%= s.first_name %> <%= s.last_name %></h3>
                <p><%= s.pending_count %> ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</p>
            </div>
        <% }); %>
    </div>

    <div class="filter-box">
        <form action="/report-repairs" method="GET">
            <label>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏≤‡∏á:</label>
            <select name="tech_id">
                <option value="">-- ‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                <% techs.forEach(t => { %>
                    <option value="<%= t.technician_id %>" <%= tech_filter == t.technician_id ? 'selected' : '' %>>‡∏ä‡πà‡∏≤‡∏á <%= t.first_name %></option>
                <% }); %>
            </select>
            
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
            <select name="status">
                <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
                <option value="Pending" <%= status_filter == 'Pending' ? 'selected' : '' %>>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Pending)</option>
                <option value="In Progress" <%= status_filter == 'In Progress' ? 'selected' : '' %>>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏° (In Progress)</option>
                <option value="Completed" <%= status_filter == 'Completed' ? 'selected' : '' %>>‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à (Completed)</option>
                <option value="Canceled" <%= status_filter == 'Canceled' ? 'selected' : '' %>>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (Canceled)</option>
            </select>
            
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</label>
            <input type="date" name="receive_date" value="<%= date_filter %>">
            
            <button type="submit">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <a href="/report-repairs" style="font-size: 14px; text-decoration: none; color: #f44336;">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</a>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå/‡∏£‡∏∏‡πà‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                <th>‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
            </tr>
        </thead>
        <tbody>
            <% if (repairs.length === 0) { %>
                <tr><td colspan="6" style="text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>
            <% } else { %>
                <% repairs.forEach(r => { %>
                    <tr>
                        <td><%= r.repair_id %></td>
                        <td><%= r.receive_date %></td>
                        <td><%= r.c_fname %></td>
                        <td><%= r.brand %> <%= r.model %></td>
                        <td>‡∏ä‡πà‡∏≤‡∏á <%= r.t_fname %></td>
                        <td class="<%= r.status === 'Completed' ? 'status-completed' : (r.status === 'In Progress' ? 'status-inprogress' : (r.status === 'Canceled' ? 'status-canceled' : 'status-pending')) %>">
                            <%= r.status %>
                        </td>
                    </tr>
                <% }); %>
            <% } %>
        </tbody>
    </table>

</body>
</html>